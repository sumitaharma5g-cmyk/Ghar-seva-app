
<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§ò‡§∞ ‡§∏‡•á‡§µ‡§æ ‡§ê‡§™ - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .hidden { display: none !important; }
        .star { cursor: pointer; transition: all 0.2s; }
        .star:hover { transform: scale(1.1); }
        @media print {
            body * { visibility: hidden; }
            .print-area, .print-area * { visibility: visible; }
            .print-area { position: absolute; left: 0; top: 0; width: 100%; }
        }
    </style>
</head>
<body class="bg-gray-50">

<div id="app"></div>

<script>
    // Admin credentials
    const ADMIN_USERNAME = 'admin';
    const ADMIN_PASSWORD = 'admin123';

    // Available areas
    const areas = [
        '‡§≤‡§æ‡§ú‡§™‡§§ ‡§®‡§ó‡§∞', '‡§∞‡§æ‡§ú‡•å‡§∞‡•Ä ‡§ó‡§æ‡§∞‡•ç‡§°‡§®', '‡§¶‡•ç‡§µ‡§æ‡§∞‡§ï‡§æ', '‡§∞‡•ã‡§π‡§ø‡§£‡•Ä', '‡§™‡•Ä‡§§‡§Æ‡§™‡•Å‡§∞‡§æ',
        '‡§ï‡§∞‡•ã‡§≤ ‡§¨‡§æ‡§ó', '‡§∏‡§∞‡§ø‡§§‡§æ ‡§µ‡§ø‡§π‡§æ‡§∞', '‡§®‡•á‡§π‡§∞‡•Ç ‡§™‡•ç‡§≤‡•á‡§∏', '‡§ï‡§®‡•â‡§ü ‡§™‡•ç‡§≤‡•á‡§∏', '‡§µ‡§∏‡§Ç‡§§ ‡§ï‡•Å‡§Ç‡§ú'
    ];

    // State Management
    let state = {
        userType: null,
        isLoggedIn: false,
        currentUser: null,
        isAdmin: false,
        workers: [
            { 
                id: 1, 
                name: '‡§∞‡§æ‡§ú‡•á‡§∂ ‡§ï‡•Å‡§Æ‡§æ‡§∞', 
                phone: '9876543210', 
                category: '‡§™‡•ç‡§≤‡§Ç‡§¨‡§ø‡§Ç‡§ó', 
                experience: '8', 
                area: '‡§≤‡§æ‡§ú‡§™‡§§ ‡§®‡§ó‡§∞',
                upiId: 'rajesh@paytm',
                rating: 4.5,
                totalReviews: 23,
                verified: true,
                reviews: []
            },
            { 
                id: 2, 
                name: '‡§∏‡•Å‡§∞‡•á‡§∂ ‡§∂‡§∞‡•ç‡§Æ‡§æ', 
                phone: '9876543211', 
                category: '‡§á‡§≤‡•á‡§ï‡•ç‡§ü‡•ç‡§∞‡§ø‡§∂‡§ø‡§Ø‡§®', 
                experience: '12', 
                area: '‡§∞‡§æ‡§ú‡•å‡§∞‡•Ä ‡§ó‡§æ‡§∞‡•ç‡§°‡§®',
                upiId: 'suresh@phonepe',
                rating: 4.8,
                totalReviews: 45,
                verified: true,
                reviews: []
            }
        ],
        customers: [],
        requests: [],
        formData: { name: '', phone: '', category: '', experience: '', area: '', upiId: '' },
        requestData: { category: '', description: '', photo: null, area: '', estimatedPrice: '' },
        feedbackData: { rating: 0, comment: '' },
        paymentData: { amount: '', transactionId: '' },
        showPayment: null,
        showFeedback: null,
        showSlip: null,
        adminLogin: { username: '', password: '' }
    };

    const categories = [
        { name: '‡§™‡•ç‡§≤‡§Ç‡§¨‡§ø‡§Ç‡§ó', icon: 'üö∞', basePrice: 300 },
        { name: '‡§á‡§≤‡•á‡§ï‡•ç‡§ü‡•ç‡§∞‡§ø‡§∂‡§ø‡§Ø‡§®', icon: '‚ö°', basePrice: 400 },
        { name: '‡§ó‡•à‡§∏ ‡§∏‡§ø‡§≤‡•á‡§Ç‡§°‡§∞', icon: 'üî•', basePrice: 200 },
        { name: '‡§ï‡§ø‡§ö‡§® ‡§∞‡§ø‡§™‡•á‡§Ø‡§∞', icon: 'üç≥', basePrice: 500 },
        { name: '‡§õ‡§§/‡§¶‡•Ä‡§µ‡§æ‡§∞', icon: 'üè†', basePrice: 600 },
        { name: '‡§Ö‡§®‡•ç‡§Ø ‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä', icon: 'üîß', basePrice: 350 }
    ];

    function generateQRCode(upiId, name, amount = '') {
        const upiString = `upi://pay?pa=${upiId}&pn=${encodeURIComponent(name)}${amount ? `&am=${amount}` : ''}&cu=INR`;
        return `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(upiString)}`;
    }

    function generateRequestId() {
        return 'REQ' + Date.now().toString().slice(-8);
    }

    function render() {
        const app = document.getElementById('app');
        
        if (state.showSlip) {
            app.innerHTML = renderRequestSlip();
        } else if (state.showPayment) {
            app.innerHTML = renderPaymentScreen();
        } else if (state.showFeedback) {
            app.innerHTML = renderFeedbackScreen();
        } else if (state.isAdmin) {
            app.innerHTML = renderAdminDashboard();
        } else if (!state.userType) {
            app.innerHTML = renderUserTypeSelection();
        } else if (!state.isLoggedIn) {
            app.innerHTML = renderRegistration();
        } else if (state.userType === 'customer') {
            app.innerHTML = renderCustomerDashboard();
        } else if (state.userType === 'worker') {
            app.innerHTML = renderWorkerDashboard();
        }
    }

    function renderUserTypeSelection() {
        return `
            <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
                <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                    <div class="text-center mb-8">
                        <div class="text-6xl mb-4">üîß</div>
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">‡§ò‡§∞ ‡§∏‡•á‡§µ‡§æ ‡§ê‡§™</h1>
                        <p class="text-gray-600">‡§Ö‡§™‡§®‡•á ‡§ò‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä ‡§¢‡•Ç‡§Ç‡§¢‡•á‡§Ç</p>
                    </div>
                    <div class="space-y-4">
                        <button onclick="selectUserType('customer')" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-4 px-6 rounded-xl transition duration-300 flex items-center justify-center gap-3 shadow-lg">
                            <span class="text-2xl">üë§</span>
                            ‡§Æ‡•à‡§Ç ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§π‡•Ç‡§Ç
                        </button>
                        <button onclick="selectUserType('worker')" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-4 px-6 rounded-xl transition duration-300 flex items-center justify-center gap-3 shadow-lg">
                            <span class="text-2xl">üîß</span>
                            ‡§Æ‡•à‡§Ç ‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä ‡§π‡•Ç‡§Ç
                        </button>
                        <button onclick="selectUserType('admin')" class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-4 px-6 rounded-xl transition duration-300 flex items-center justify-center gap-3 shadow-lg">
                            <span class="text-2xl">üë®‚Äçüíº</span>
                            Admin Login
                        </button>
                    </div>
                </div>
            </div>
        `;
    }

    function renderRegistration() {
        if (state.userType === 'admin') {
            return `
                <div class="min-h-screen bg-gradient-to-br from-red-50 to-orange-100 flex items-center justify-center p-4">
                    <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">üîê Admin Login</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Username</label>
                                <input type="text" id="adminUser" onchange="updateAdminLogin('username', this.value)" class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="admin">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">Password</label>
                                <input type="password" id="adminPass" onchange="updateAdminLogin('password', this.value)" class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            </div>
                            <button onclick="handleAdminLogin()" class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-6 rounded-lg">Login</button>
                            <button onclick="resetUserType()" class="w-full text-gray-600 hover:text-gray-800 py-2">‡§µ‡§æ‡§™‡§∏ ‡§ú‡§æ‡§è‡§Ç</button>
                        </div>
                    </div>
                </div>
            `;
        }

        const isWorker = state.userType === 'worker';
        return `
            <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
                <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">
                        ${isWorker ? '‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§®' : '‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§®'}
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡§®‡§æ‡§Æ</label>
                            <input type="text" id="name" onchange="updateFormData('name', this.value)" class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="‡§Ö‡§™‡§®‡§æ ‡§®‡§æ‡§Æ">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞</label>
                            <input type="tel" id="phone" onchange="updateFormData('phone', this.value)" class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="10 ‡§Ö‡§Ç‡§ï">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞/‡§á‡§≤‡§æ‡§ï‡§æ</label>
                            <select id="area" onchange="updateFormData('area', this.value)" class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                <option value="">‡§ö‡•Å‡§®‡•á‡§Ç</option>
                                ${areas.map(a => `<option value="${a}">${a}</option>`).join('')}
                            </select>
                        </div>
                        ${isWorker ? `
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä</label>
                                <select id="category" onchange="updateFormData('category', this.value)" class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                    <option value="">‡§ö‡•Å‡§®‡•á‡§Ç</option>
                                    ${categories.map(cat => `<option value="${cat.name}">${cat.name}</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">‡§Ö‡§®‡•Å‡§≠‡§µ (‡§µ‡§∞‡•ç‡§∑)</label>
                                <input type="number" id="experience" onchange="updateFormData('experience', this.value)" class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="5">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">UPI ID <span class="text-red-500">*</span></label>
                                <input type="text" id="upiId" onchange="updateFormData('upiId', this.value)" class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="name@paytm">
                            </div>
                        ` : ''}
                        <button onclick="handleRegister()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg">‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç</button>
                        <button onclick="resetUserType()" class="w-full text-gray-600 hover:text-gray-800 py-2">‡§µ‡§æ‡§™‡§∏ ‡§ú‡§æ‡§è‡§Ç</button>
                    </div>
                </div>
            </div>
        `;
    }

    function renderCustomerDashboard() {
        const filteredWorkers = state.workers.filter(w => {
            const categoryMatch = !state.requestData.category || w.category === state.requestData.category;
            const areaMatch = !state.requestData.area || w.area === state.requestData.area;
            return categoryMatch && areaMatch && w.verified;
        });

        return `
            <div class="min-h-screen bg-gray-50">
                <header class="bg-indigo-600 text-white p-4 shadow-lg">
                    <div class="max-w-6xl mx-auto flex justify-between items-center">
                        <div class="flex items-center gap-2">
                            <span class="text-3xl">üîß</span>
                            <div>
                                <h1 class="text-xl md:text-2xl font-bold">‡§ò‡§∞ ‡§∏‡•á‡§µ‡§æ ‡§ê‡§™</h1>
                                <p class="text-xs">${state.currentUser.name} - ${state.currentUser.area}</p>
                            </div>
                        </div>
                        <button onclick="logout()" class="bg-red-500 hover:bg-red-600 px-3 py-2 rounded-lg text-sm">üö™ ‡§≤‡•â‡§ó‡§Ü‡§â‡§ü</button>
                    </div>
                </header>
                <div class="max-w-6xl mx-auto p-4 md:p-6">
                    <div class="bg-white rounded-xl shadow-lg p-4 md:p-6 mb-6">
                        <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-6">‡§®‡§Ø‡§æ ‡§∞‡§ø‡§ï‡•ç‡§µ‡•á‡§∏‡•ç‡§ü ‡§≠‡•á‡§ú‡•á‡§Ç</h2>
                        <div class="space-y-6">
                            <div>
                                <label class="block text-gray-700 font-medium mb-3">‡§Ö‡§™‡§®‡§æ ‡§á‡§≤‡§æ‡§ï‡§æ</label>
                                <select onchange="updateRequestData('area', this.value)" class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                    <option value="">‡§Ö‡§™‡§®‡§æ area ‡§ö‡•Å‡§®‡•á‡§Ç</option>
                                    ${areas.map(a => `<option value="${a}" ${state.requestData.area === a ? 'selected' : ''}>${a}</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-3">‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä</label>
                                <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                                    ${categories.map(cat => `
                                        <button onclick="selectCategory('${cat.name}', ${cat.basePrice})" class="p-3 md:p-4 rounded-xl border-2 ${state.requestData.category === cat.name ? 'border-indigo-600 bg-indigo-50' : 'border-gray-200'}">
                                            <div class="text-3xl md:text-4xl mb-2">${cat.icon}</div>
                                            <p class="text-xs md:text-sm font-medium">${cat.name}</p>
                                            <p class="text-xs text-green-600">‚Çπ${cat.basePrice}+</p>
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                            ${state.requestData.estimatedPrice ? `
                                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                    <p class="text-sm text-gray-600">‡§Ö‡§®‡•Å‡§Æ‡§æ‡§®‡§ø‡§§ ‡§ï‡•Ä‡§Æ‡§§:</p>
                                    <p class="text-2xl font-bold text-green-600">‚Çπ${state.requestData.estimatedPrice}</p>
                                </div>
                            ` : ''}
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">‡§ï‡§æ‡§Æ ‡§ï‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£</label>
                                <textarea onchange="updateRequestData('description', this.value)" class="w-full px-4 py-3 border rounded-lg" rows="4" placeholder="‡§µ‡§ø‡§∏‡•ç‡§§‡§æ‡§∞ ‡§∏‡•á ‡§¨‡§§‡§æ‡§è‡§Ç...">${state.requestData.description}</textarea>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">‡§´‡•ã‡§ü‡•ã</label>
                                <input type="file" accept="image/*" onchange="handleImageUpload(event)" class="w-full px-4 py-3 border rounded-lg">
                                ${state.requestData.photo ? `<img src="${state.requestData.photo}" class="mt-4 max-w-xs rounded-lg">` : ''}
                            </div>
                            <button onclick="handleRequest()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-4 rounded-lg">‡§∞‡§ø‡§ï‡•ç‡§µ‡•á‡§∏‡•ç‡§ü ‡§≠‡•á‡§ú‡•á‡§Ç</button>
                        </div>
                    </div>
                    ${state.requestData.category && state.requestData.area ? `
                        <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
                            <h2 class="text-xl md:text-2xl font-bold mb-4">${state.requestData.area} ‡§Æ‡•á‡§Ç ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä</h2>
                            ${filteredWorkers.length === 0 ? 
                                '<p class="text-center py-8 text-gray-600">‡§á‡§∏ area ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§¶‡•Ç‡§∏‡§∞‡§æ area ‡§ö‡•Å‡§®‡•á‡§Ç‡•§</p>' :
                                `<div class="grid md:grid-cols-2 gap-4">
                                    ${filteredWorkers.map(w => `
                                        <div class="border rounded-lg p-4 hover:shadow-lg transition">
                                            <div class="flex justify-between mb-3">
                                                <div>
                                                    <h3 class="text-lg font-bold flex items-center gap-2">
                                                        ${w.name}
                                                        ${w.verified ? '<span class="text-blue-500" title="Verified">‚úì</span>' : ''}
                                                    </h3>
                                                    <p class="text-sm text-gray-600">${w.category}</p>
                                                    <p class="text-sm text-gray-500">üìç ${w.area}</p>
                                                    <div class="flex gap-1 mt-1">
                                                        <span class="text-yellow-400">‚≠ê</span>
                                                        <span class="text-sm font-medium">${w.rating.toFixed(1)}</span>
                                                        <span class="text-xs text-gray-500">(${w.totalReviews})</span>
                                                    </div>
                                                </div>
                                                <p class="text-sm text-indigo-600 font-medium">${w.experience} ‡§∏‡§æ‡§≤</p>
                                            </div>
                                            <div class="flex gap-2">
                                                <a href="tel:${w.phone}" class="flex-1 bg-green-500 text-white py-3 rounded-lg text-center text-sm">üìû ‡§ï‡•â‡§≤</a>
                                                <button onclick="showPaymentScreen(${w.id}, '${w.name}')" class="flex-1 bg-indigo-500 text-white py-3 rounded-lg text-sm">üí≥ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü</button>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>`
                            }
                        </div>
                    ` : ''}
                </div>
            </div>
        `;
    }

    function renderWorkerDashboard() {
        const myRequests = state.requests.filter(r => r.category === state.currentUser.category && r.workerArea === state.currentUser.area);
        return `
            <div class="min-h-screen bg-gray-50">
                <header class="bg-green-600 text-white p-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <h1 class="text-xl md:text-2xl font-bold">üîß ‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä Dashboard</h1>
                            <p class="text-sm">${state.currentUser.category} - ${state.currentUser.area}</p>
                        </div>
                        <button onclick="logout()" class="bg-red-500 px-3 py-2 rounded-lg text-sm">‡§≤‡•â‡§ó‡§Ü‡§â‡§ü</button>
                    </div>
                </header>
                <div class="max-w-6xl mx-auto p-4 md:p-6">
                    <div class="bg-white rounded-xl shadow-lg p-4 md:p-6 mb-6">
                        <h2 class="text-xl font-bold mb-4">‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤ ${state.currentUser.verified ? '<span class="text-blue-500">‚úì Verified</span>' : '<span class="text-red-500">‚ö† Pending</span>'}</h2>
                        <div class="grid md:grid-cols-2 gap-4 mb-6">
                            <p><strong>‡§®‡§æ‡§Æ:</strong> ${state.currentUser.name}</p>
                            <p><strong>‡§´‡•ã‡§®:</strong> ${state.currentUser.phone}</p>
                            <p><strong>‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä:</strong> ${state.currentUser.category}</p>
                            <p><strong>‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞:</strong> ${state.currentUser.area}</p>
                            <p><strong>UPI:</strong> ${state.currentUser.upiId}</p>
                        </div>
                        <h3 class="font-bold mb-3">üì± QR Code</h3>
                        <img src="${generateQRCode(state.currentUser.upiId, state.currentUser.name)}" class="rounded-lg shadow-md w-48">
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
                        <h2 class="text-xl font-bold mb-6">‡§®‡§è ‡§∞‡§ø‡§ï‡•ç‡§µ‡•á‡§∏‡•ç‡§ü (${myRequests.length})</h2>
                        ${myRequests.length === 0 ? '<p class="text-center py-8">‡§ï‡•ã‡§à ‡§∞‡§ø‡§ï‡•ç‡§µ‡•á‡§∏‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç</p>' : myRequests.map(req => `
                            <div class="border rounded-lg p-4 mb-4">
                                <div class="flex justify-between mb-2">
                                    <div>
                                        <h3 class="font-bold">${req.customerName}</h3>
                                        <p class="text-sm text-gray-500">${req.requestId}</p>
                                    </div>
                                    <span class="text-xs bg-blue-100 px-2 py-1 rounded">${req.timestamp}</span>
                                </div>
                                <p class="my-3">${req.description}</p>
                                <p class="text-green-600 font-bold mb-2">‡§Ö‡§®‡•Å‡§Æ‡§æ‡§®‡§ø‡§§: ‚Çπ${req.estimatedPrice}</p>
                                ${req.photo ? `<img src="${req.photo}" class="max-w-sm rounded-lg mb-4">` : ''}
                                <div class="flex gap-2">
                                    <a href="tel:${req.customerPhone}" class="flex-1 bg-green-500 text-white py-3 rounded-lg text-center">üìû ‡§ï‡•â‡§≤</a>
                                    <button onclick="viewSlip('${req.requestId}')" class="flex-1 bg-indigo-500 text-white py-3 rounded-lg">üìÑ Slip ‡§¶‡•á‡§ñ‡•á‡§Ç</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
        `;
    }

    function renderAdminDashboard() {
        return `
            <div class="min-h-screen bg-gray-50">
                <header class="bg-red-600 text-white p-4">
                    <div class="flex justify-between items-center max-w-7xl mx-auto">
                        <h1 class="text-2xl font-bold">üë®‚Äçüíº Admin Panel</h1>
                        <button onclick="logout()" class="bg-white text-red-600 px-4 py-2 rounded-lg font-semibold">Logout</button>
                    </div>
                </header>
                <div class="max-w-7xl mx-auto p-6">
                    <div class="grid md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-gray-600 text-sm">Total Workers</h3>
                            <p class="text-3xl font-bold text-indigo-600">${state.workers.length}</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-gray-600 text-sm">Total Customers</h3>
                            <p class="text-3xl font-bold text-green-600">${state.customers.length}</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-gray-600 text-sm">Total Requests</h3>
                            <p class="text-3xl font-bold text-blue-600">${state.requests.length}</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-gray-600 text-sm">Pending Approvals</h3>
                            <p class="text-3xl font-bold text-orange-600">${state.workers.filter(w => !w.verified).length}</p>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <h2 class="text-2xl font-bold mb-4">üë∑ All Workers</h2>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="p-3 text-left">Name</th>
                                        <th class="p-3 text-left">Phone</th>
                                        <th class="p-3 text-left">Category</th>
                                        <th class="p-3 text-left">Area</th>
                                        <th class="p-3 text-left">Status</th>
                                        <th class="p-3 text-left">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${state.workers.map(w => `
                                        <tr class="border-b">
                                            <td class="p-3">${w.name}</td>
                                            <td class="p-3">${w.phone}</td>
                                            <td class="p-3">${w.category}</td>
                                            <td class="p-3">${w.area}</td>
                                            <td class="p-3">${w.verified ? '<span class="text-green-600">‚úì Verified</span>' : '<span class="text-orange-600">‚è≥ Pending</span>'}</td>
                                            <td class="p-3">
                                                ${!w.verified ? `<button onclick="approveWorker(${w.id})" class="bg-green-500 text-white px-3 py-1 rounded text-sm">Approve</button>` : ''}
                                                <button onclick="deleteWorker(${w.id})" class="bg-red-500 text-white px-3 py-1 rounded text-sm ml-2">Delete</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <h2 class="text-2xl font-bold mb-4">üë• All Customers</h2>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="p-3 text-left">Name</th>
                                        <th class="p-3 text-left">Phone</th>
                                        <th class="p-3 text-left">Area</th>
                                        <th class="p-3 text-left">Total Requests</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${state.customers.map(c => `
                                        <tr class="border-b">
                                            <td class="p-3">${c.name}</td>
                                            <td class="p-3">${c.phone}</td>
                                            <td class="p-3">${c.area}</td>
                                            <td class="p-3">${state.requests.filter(r => r.customerId === c.id).length}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                            </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-2xl font-bold mb-4">üìã All Requests</h2>
                        <div class="space-y-4">
                            ${state.requests.map(req => `
                                <div class="border rounded-lg p-4">
                                    <div class="flex justify-between mb-2">
                                        <div>
                                            <p class="font-bold">${req.requestId}</p>
                                            <p class="text-sm text-gray-600">${req.customerName} ‚Üí ${req.category}</p>
                                        </div>
                                        <span class="text-xs bg-blue-100 px-3 py-1 rounded">${req.timestamp}</span>
                                    </div>
                                    <p class="text-sm mb-2">${req.description}</p>
                                    <div class="flex gap-2 text-sm">
                                        <span class="bg-green-100 px-2 py-1 rounded">‚Çπ${req.estimatedPrice}</span>
                                        <span class="bg-purple-100 px-2 py-1 rounded">üìç ${req.area}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    function renderRequestSlip() {
        const req = state.requests.find(r => r.requestId === state.showSlip);
        if (!req) return '<p>Request not found</p>';

        const worker = state.workers.find(w => w.category === req.category && w.area === req.workerArea);

        return `
            <div class="min-h-screen bg-gray-100 p-4 flex items-center justify-center">
                <div class="bg-white max-w-2xl w-full rounded-xl shadow-2xl overflow-hidden">
                    <div class="print-area">
                        <div class="bg-indigo-600 text-white p-6 text-center">
                            <h1 class="text-3xl font-bold mb-2">‡§ò‡§∞ ‡§∏‡•á‡§µ‡§æ ‡§ê‡§™</h1>
                            <p class="text-sm">Work Request Slip</p>
                        </div>
                        
                        <div class="p-8">
                            <div class="text-center mb-6">
                                <div class="inline-block bg-yellow-100 px-4 py-2 rounded-lg">
                                    <p class="text-sm text-gray-600">Request ID</p>
                                    <p class="text-2xl font-bold text-gray-800">${req.requestId}</p>
                                </div>
                            </div>

                            <div class="grid md:grid-cols-2 gap-6 mb-6">
                                <div class="border-2 border-indigo-200 rounded-lg p-4">
                                    <h3 class="font-bold text-indigo-600 mb-3 flex items-center gap-2">
                                        üë§ Customer Details
                                    </h3>
                                    <div class="space-y-2 text-sm">
                                        <p><strong>Name:</strong> ${req.customerName}</p>
                                        <p><strong>Phone:</strong> ${req.customerPhone}</p>
                                        <p><strong>Area:</strong> ${req.area}</p>
                                    </div>
                                </div>

                                ${worker ? `
                                    <div class="border-2 border-green-200 rounded-lg p-4">
                                        <h3 class="font-bold text-green-600 mb-3 flex items-center gap-2">
                                            üîß Worker Details
                                        </h3>
                                        <div class="space-y-2 text-sm">
                                            <p><strong>Name:</strong> ${worker.name}</p>
                                            <p><strong>Phone:</strong> ${worker.phone}</p>
                                            <p><strong>Category:</strong> ${worker.category}</p>
                                            <p><strong>Experience:</strong> ${worker.experience} years</p>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>

                            <div class="bg-gray-50 rounded-lg p-4 mb-6">
                                <h3 class="font-bold mb-3">üìã Work Details</h3>
                                <div class="space-y-2 text-sm">
                                    <p><strong>Category:</strong> ${req.category}</p>
                                    <p><strong>Description:</strong> ${req.description}</p>
                                    <p><strong>Date & Time:</strong> ${req.timestamp}</p>
                                </div>
                            </div>

                            <div class="bg-green-50 border-2 border-green-300 rounded-lg p-4 mb-6">
                                <div class="flex justify-between items-center">
                                    <span class="text-lg font-semibold">Estimated Price:</span>
                                    <span class="text-3xl font-bold text-green-600">‚Çπ${req.estimatedPrice}</span>
                                </div>
                                <p class="text-xs text-gray-500 mt-2">*Final price may vary based on work complexity</p>
                            </div>

                            ${req.photo ? `
                                <div class="mb-6">
                                    <h3 class="font-bold mb-3">üì∑ Work Photo</h3>
                                    <img src="${req.photo}" class="rounded-lg shadow-md max-w-full">
                                </div>
                            ` : ''}

                            <div class="border-t pt-4 mt-6">
                                <p class="text-xs text-gray-500 text-center">
                                    This is a computer-generated slip. No signature required.<br>
                                    For support: +91-1234567890 | support@gharseva.com
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gray-100 p-4 flex gap-3 print:hidden">
                        <button onclick="window.print()" class="flex-1 bg-indigo-600 text-white py-3 rounded-lg font-semibold">üñ®Ô∏è Print</button>
                        <button onclick="downloadSlip()" class="flex-1 bg-green-600 text-white py-3 rounded-lg font-semibold">üì• Download</button>
                        <button onclick="closeSlip()" class="flex-1 bg-gray-600 text-white py-3 rounded-lg font-semibold">‚úï Close</button>
                    </div>
                </div>
            </div>
        `;
    }

    function renderPaymentScreen() {
        const worker = state.workers.find(w => w.id === state.showPayment.workerId);
        return `
            <div class="min-h-screen bg-gray-50 flex items-center justify-center p-4">
                <div class="bg-white rounded-2xl shadow-2xl p-6 md:p-8 max-w-md w-full">
                    <h2 class="text-2xl font-bold mb-6 text-center">üí≥ Payment</h2>
                    <div class="bg-indigo-50 rounded-lg p-4 mb-4">
                        <p class="font-medium">${worker.name}</p>
                        <p class="text-sm">${worker.category}</p>
                    </div>
                    <div class="mb-4">
                        <label class="block font-medium mb-2">Amount (‚Çπ)</label>
                        <input type="number" id="paymentAmount" onchange="updatePaymentData('amount', this.value)" class="w-full px-4 py-3 border rounded-lg" placeholder="500">
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg mb-4 text-center">
                        <p class="text-sm mb-3">Scan QR Code</p>
                        <img src="${generateQRCode(worker.upiId, worker.name, state.paymentData.amount)}" class="mx-auto rounded-lg">
                        <p class="text-sm mt-3">UPI: <strong>${worker.upiId}</strong></p>
                    </div>
                    <button onclick="handlePayment()" class="w-full bg-green-600 text-white py-3 rounded-lg mb-3">Payment Done</button>
                    <button onclick="closePayment()" class="w-full bg-gray-200 py-3 rounded-lg">Back</button>
                </div>
            </div>
        `;
    }

    function renderFeedbackScreen() {
        return `
            <div class="min-h-screen bg-gray-50 flex items-center justify-center p-4">
                <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                    <h2 class="text-2xl font-bold mb-6 text-center">‚≠ê Feedback</h2>
                    <p class="text-center font-medium mb-6">${state.showFeedback.workerName}</p>
                    <div class="mb-6">
                        <label class="block font-medium mb-3 text-center">Rating</label>
                        <div class="flex justify-center gap-2">
                            ${[1,2,3,4,5].map(s => `
                                <button onclick="setRating(${s})" class="star text-4xl ${s <= state.feedbackData.rating ? 'text-yellow-400' : 'text-gray-300'}">‚òÖ</button>
                            `).join('')}
                        </div>
                    </div>
                    <div class="mb-6">
                        <label class="block font-medium mb-2">Comment</label>
                        <textarea onchange="updateFeedbackData('comment', this.value)" class="w-full px-4 py-3 border rounded-lg" rows="4"></textarea>
                    </div>
                    <button onclick="submitFeedback()" class="w-full bg-indigo-600 text-white py-3 rounded-lg mb-3">Submit</button>
                    <button onclick="closeFeedback()" class="w-full bg-gray-200 py-3 rounded-lg">Later</button>
                </div>
            </div>
        `;
    }

    // Functions
    function selectUserType(type) { state.userType = type; render(); }
    function resetUserType() { state.userType = null; state.adminLogin = { username: '', password: '' }; render(); }
    function updateFormData(field, value) { state.formData[field] = value; }
    function updateAdminLogin(field, value) { state.adminLogin[field] = value; }
    
    function handleAdminLogin() {
        if (state.adminLogin.username === ADMIN_USERNAME && state.adminLogin.password === ADMIN_PASSWORD) {
            state.isAdmin = true;
            state.isLoggedIn = true;
            render();
        } else {
            alert('Invalid credentials!');
        }
    }

    function handleRegister() {
        if (!state.formData.name || !state.formData.phone || !state.formData.area) {
            return alert('‡§∏‡§≠‡•Ä ‡§´‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç');
        }
        
        if (state.userType === 'worker') {
            if (!state.formData.category || !state.formData.upiId) return alert('‡§∏‡§≠‡•Ä ‡§´‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç');
            state.currentUser = { 
                id: Date.now(), 
                ...state.formData, 
                rating: 0, 
                totalReviews: 0, 
                reviews: [],
                verified: false
            };
            state.workers.push(state.currentUser);
            alert('‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® ‡§∏‡§´‡§≤! Admin approval pending.');
        } else {
            state.currentUser = { id: Date.now(), name: state.formData.name, phone: state.formData.phone, area: state.formData.area };
            state.customers.push(state.currentUser);
        }
        state.isLoggedIn = true;
        state.formData = { name: '', phone: '', category: '', experience: '', area: '', upiId: '' };
        render();
    }

    function selectCategory(cat, price) { 
        state.requestData.category = cat; 
        state.requestData.estimatedPrice = price;
        render(); 
    }

    function updateRequestData(field, value) { state.requestData[field] = value; render(); }

    function handleImageUpload(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onloadend = () => { state.requestData.photo = reader.result; render(); };
            reader.readAsDataURL(file);
        }
    }

    function handleRequest() {
        if (!state.requestData.category || !state.requestData.description || !state.requestData.area) {
            return alert('‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä, area ‡§î‡§∞ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§≠‡§∞‡•á‡§Ç');
        }

        const requestId = generateRequestId();
        const newRequest = {
            id: Date.now(),
            requestId: requestId,
            customerId: state.currentUser.id,
            customerName: state.currentUser.name,
            customerPhone: state.currentUser.phone,
            ...state.requestData,
            workerArea: state.requestData.area,
            timestamp: new Date().toLocaleString('hi-IN'),
            status: 'pending'
        };
        
        state.requests.push(newRequest);
        state.showSlip = requestId;
        render();
    }

    function viewSlip(requestId) {
        state.showSlip = requestId;
        render();
    }

    function closeSlip() {
        state.showSlip = null;
        state.requestData = { category: '', description: '', photo: null, area: '', estimatedPrice: '' };
        render();
    }

    function downloadSlip() {
        alert('Download feature - ‡§Ü‡§™ ‡§á‡§∏ slip ‡§ï‡•ã screenshot ‡§≤‡•á ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§Ø‡§æ print ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç');
    }

    function showPaymentScreen(id, name) { state.showPayment = { workerId: id, workerName: name }; render(); }
    function closePayment() { state.showPayment = null; render(); }
    function updatePaymentData(field, value) { state.paymentData[field] = value; render(); }
    
    function handlePayment() {
        if (!state.paymentData.amount) return alert('‡§∞‡§æ‡§∂‡§ø ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç');
        state.showFeedback = { 
            workerId: state.showPayment.workerId, 
            workerName: state.showPayment.workerName, 
            amount: state.paymentData.amount 
        };
        state.showPayment = null;
        render();
    }

    function setRating(r) { state.feedbackData.rating = r; render(); }
    function updateFeedbackData(field, value) { state.feedbackData[field] = value; }
    
    function submitFeedback() {
        if (!state.feedbackData.rating) return alert('‡§∞‡•á‡§ü‡§ø‡§Ç‡§ó ‡§¶‡•á‡§Ç');
        const idx = state.workers.findIndex(w => w.id === state.showFeedback.workerId);
        if (idx !== -1) {
            const review = { 
                id: Date.now(), 
                customerName: state.currentUser.name, 
                rating: state.feedbackData.rating, 
                comment: state.feedbackData.comment, 
                timestamp: new Date().toLocaleString('hi-IN') 
            };
            state.workers[idx].reviews.push(review);
            state.workers[idx].rating = state.workers[idx].reviews.reduce((a,r) => a + r.rating, 0) / state.workers[idx].reviews.length;
            state.workers[idx].totalReviews = state.workers[idx].reviews.length;
        }
        alert('‡§´‡•Ä‡§°‡§¨‡•à‡§ï submit ‡§π‡•ã ‡§ó‡§Ø‡§æ!');
        state.showFeedback = null;
        state.feedbackData = { rating: 0, comment: '' };
        render();
    }

    function closeFeedback() { state.showFeedback = null; render(); }
    
    function approveWorker(id) {
        const idx = state.workers.findIndex(w => w.id === id);
        if (idx !== -1) {
            state.workers[idx].verified = true;
            alert('Worker approved!');
            render();
        }
    }

    function deleteWorker(id) {
        if (confirm('Are you sure you want to delete this worker?')) {
            state.workers = state.workers.filter(w => w.id !== id);
            render();
        }
    }

    function logout() { 
        state = { 
            ...state, 
            isLoggedIn: false, 
            userType: null, 
            currentUser: null,
            isAdmin: false,
            requestData: { category: '', description: '', photo: null, area: '', estimatedPrice: '' }
        }; 
        render(); 
    }

  
